{% extends "admin/challenges/create.html" %} {% block header %}
<div class="alert alert-info" role="alert">
  <strong
    ><i class="fas fa-layer-group"></i> Container Compose Challenge</strong
  >
  — Multi-container challenges using YAML configuration. All containers run on a
  private network, with the entry container exposed via Tailscale.
</div>
{% endblock %} {% block value %}
<div class="form-group">
  <label for="scoring_type"
    >Scoring Type<br />
    <small class="form-text text-muted">
      Choose between static points or dynamic decay scoring
    </small>
  </label>
  <select class="form-control" id="scoring_type" name="scoring_type">
    <option value="standard" selected>Standard (Fixed Points)</option>
    <option value="dynamic">Dynamic (Decay-based)</option>
  </select>
</div>

<!-- Standard Scoring (shown by default) -->
<div id="standard-scoring" class="scoring-section">
  <div class="form-group">
    <label for="value"
      >Points<br />
      <small class="form-text text-muted">
        Fixed number of points for this challenge
      </small>
    </label>
    <input
      type="number"
      class="form-control"
      name="value"
      id="standard_value"
      placeholder="Enter value"
      required
    />
  </div>
</div>

<!-- Dynamic Scoring (hidden by default) -->
<div id="dynamic-scoring" class="scoring-section" style="display: none">
  <div class="form-group">
    <label for="initial"
      >Initial Value<br />
      <small class="form-text text-muted"
        >This is how many points the challenge is worth initially</small
      >
    </label>
    <input
      type="number"
      class="form-control"
      name="initial"
      id="dynamic_initial"
      placeholder="Enter initial value"
    />
  </div>
  <div class="form-group">
    <label for="decay_function"
      >Decay Function<br />
      <small class="form-text text-muted"
        >How the dynamic value will be calculated</small
      >
    </label>
    <select class="form-control" name="decay_function" id="decay_function">
      <option value="linear" selected>Linear</option>
      <option value="logarithmic">Logarithmic</option>
    </select>
  </div>
  <div class="form-group">
    <label for="decay"
      >Decay<br />
      <small class="form-text text-muted"
        >Number of solves before challenge reaches minimum value</small
      >
    </label>
    <input
      type="number"
      class="form-control"
      name="decay"
      id="dynamic_decay"
      placeholder="Enter decay limit"
    />
  </div>
  <div class="form-group">
    <label for="minimum"
      >Minimum Value<br />
      <small class="form-text text-muted"
        >This is the lowest that the challenge can be worth</small
      >
    </label>
    <input
      type="number"
      class="form-control"
      name="minimum"
      id="dynamic_minimum"
      placeholder="Enter minimum value"
    />
  </div>
</div>

<!-- Compose Config (main field for this challenge type) -->
<div class="form-group">
  <label>
    <strong>Compose Config (YAML)</strong><br />
    <small class="form-text text-muted">
      Define multiple containers for this challenge. One container must have
      <code>expose</code> to be the entry point.<br />
      All containers share a private Docker network and can communicate by
      hostname.
      <details class="mt-1">
        <summary>Example YAML</summary>
        <pre>
containers:
  - name: waf
    image: challenges/waf:latest
    expose: 8080
    environment:
      PHP_BACKEND: "http://web:80"
  - name: web
    image: challenges/web:latest
  - name: db
    image: challenges/db:latest
    environment:
      MYSQL_ROOT_PASSWORD: secret
    command: "--character-set-server=latin1"</pre
        >
      </details>
    </small>
  </label>
  <textarea
    class="form-control"
    name="compose_config"
    id="compose_config"
    rows="10"
    placeholder="containers:&#10;  - name: web&#10;    image: my-web:latest&#10;    expose: 80&#10;  - name: db&#10;    image: mysql:8.0"
    required
  ></textarea>
</div>

<!-- Hidden image field (required by model, auto-set to [compose-mode]) -->
<input type="hidden" name="image" value="[compose-mode]" />

<div class="form-group">
  <label>
    Connect type<br />
    <small class="form-text text-muted">Connect via web or tcp (Netcat)</small>
  </label>
  <select class="form-control" name="connection_type">
    <option value="http">Web (HTTP)</option>
    <option value="tcp">TCP (Netcat)</option>
  </select>
</div>

<div class="form-group">
  <label>
    Docker Command (Optional)<br />
    <small class="form-text text-muted">
      Custom command for the entry container (leave empty to use image default)
    </small>
  </label>
  <input
    type="text"
    class="form-control"
    name="command"
    placeholder="Leave empty for default"
  />
</div>

<!-- Internal port is derived from expose in YAML, but we need a hidden field -->
<input
  type="hidden"
  name="internal_port"
  id="internal_port_hidden"
  value="80"
/>

<!-- Flag Pattern Configuration -->
<div class="form-group">
  <label for="flag_pattern"
    >Flag Pattern<br />
    <small class="form-text text-muted">
      <strong>Easy flag configuration! Just enter your flag pattern:</strong>
      <ul>
        <li>
          <strong>Static flag:</strong> <code>CTF{this_is_the_flag}</code> →
          Same flag for everyone
        </li>
        <li>
          <strong>Random flag:</strong>
          <code>CTF{this_is_the_flag_&lt;ran_8&gt;}</code> → Unique flag per
          team/user
        </li>
      </ul>
      <em>Note: You don't need to manually add flags in the flag popup!</em>
    </small>
  </label>
  <input
    type="text"
    class="form-control"
    id="flag_pattern"
    placeholder="CTF{example_flag}"
    value="CTF{}"
  />
  <small id="flag_pattern_preview" class="form-text text-info"></small>
</div>

<!-- Hidden fields (auto-filled by JavaScript) -->
<input type="hidden" id="flag_mode" name="flag_mode" value="static" />
<input type="hidden" id="flag_prefix" name="flag_prefix" value="CTF{" />
<input type="hidden" id="flag_suffix" name="flag_suffix" value="}" />
<input
  type="hidden"
  id="random_flag_length"
  name="random_flag_length"
  value="0"
/>

{% endblock %} {% block type %}
<input type="hidden" value="container-compose" name="type" id="chaltype" />
{% endblock %}
